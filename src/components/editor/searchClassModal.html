<form name="form">
  <modal-template editing="false">
    <modal-title>
      <span ng-show="ctrl.onlySelection" translate>Select class</span>
      <span ng-hide="ctrl.onlySelection" translate>Add class</span>
    </modal-title>

    <modal-body>

      <div class="row">

        <div class="col-md-4">
          <p ng-hide="ctrl.onlySelection" translate>Class search or create info</p>
          <p ng-show="ctrl.onlySelection" translate>Class search info</p>
          <div class="input-group input-group-lg">
            <input autofocus type="text" class="form-control" placeholder="{{'search class' | translate}}"
                   ng-model="ctrl.searchText"
                   ng-model-options="{ debounce: { 'default': 500, 'blur': 0 } }"
                   key-control="ctrl.searchResults" />
            <i class="glyphicon glyphicon-search form-control-feedback"></i>
          </div>

          <div class="search-filters">
            <span class="title" translate>Filter results</span>
            <div class="form-group">
              <label for="model" translate>Defined by</label>
              <div class="input-group input-group-md">
                <div class="selectContainer">
                  <select id="model" class="form-control" ng-model="ctrl.showModel"
                          ng-options="ctrl.isThisModel(model)
                                    ? ('Assigned to this ' + ctrl.model.normalizedType | translate)
                                    : (model | translateLabel: ctrl.model)
                                    for model in ctrl.models">
                    <option value="" translate>All models</option>
                  </select>
                </div>
              </div>

              <div class="checkbox" ng-hide="ctrl.onlySelection">
                <label><input type="checkbox" ng-model="ctrl.showProfiles">{{'Show classes defined in profiles' | translate}}</label>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4 search-results">
          <ajax-loading-indicator ng-if="ctrl.loadingResults"></ajax-loading-indicator>

          <search-results ng-if="!ctrl.loadingResults" items="ctrl.searchResults" selected="ctrl.selectedItem" exclude="ctrl.exclude" on-select="ctrl.selectItem(item)">
            <div><i ng-class="searchResult.glyphIconClass"></i><h5>{{searchResult | translateLabel: ctrl.model}}</h5></div>
            <p>{{searchResult.definedBy | translateLabel: ctrl.model}} <ajax-loading-indicator-small ng-if="ctrl.loadingSelection(searchResult)"></ajax-loading-indicator-small></p>
          </search-results>
        </div>

        <div class="col-md-4 search-selection">
          <class-form ng-if="!ctrl.isSelectionExternalEntity() && ctrl.selection" class="ctrl.selection" old-class="ctrl.selection" model="ctrl.model" open-property-id="openPropertyId"></class-form>

          <div ng-if="ctrl.isSelectionExternalEntity()">

            <editable data-title="External URI" context="ctrl.model" autofocus>
              <div class="input-group input-group-md">
                <input id="externalUri" type="text" class="form-control" required uri-input="required-namespace" model="ctrl.model" ng-model="ctrl.selection.id" />
              </div>
            </editable>

            <div ng-if="ctrl.externalClass === null">
              <editable data-title="Class label" context="ctrl.model">
                <input type="text" class="form-control" string-input="label" required ng-model="ctrl.selection.label" />
              </editable>
            </div>

            <div ng-if="ctrl.externalClass">
              <non-editable data-title="Class label" value="ctrl.externalClass.label" context="ctrl.model"></non-editable>
            </div>
          </div>

          <submit-error-panel error="ctrl.submitError"></submit-error-panel>
        </div>
      </div>

    </modal-body>

    <modal-buttons>
      <div class="alert alert-danger" style="display: inline; margin-right: 10px;" role="alert" ng-show="ctrl.cannotConfirm">
        <span class="fa fa-exclamation-circle" aria-hidden="true"></span>
        <span>{{ctrl.cannotConfirm | translate}}</span>
      </div>
      <button type="button" class="btn btn-default cancel" ng-click="ctrl.close()" translate>Cancel</button>
      <button type="button"
              class="btn btn-default confirm"
              ng-click="ctrl.confirm()"
              ng-disabled="!ctrl.selection || ctrl.cannotConfirm || form.$invalid || form.$pending || ctrl.isExternalClassPending()">
        {{ctrl.textForSelection(ctrl.selection) | translate}}
      </button>
    </modal-buttons>
  </modal-template>
</form>
