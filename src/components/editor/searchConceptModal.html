<form name="form">
  <modal-template editing="true">
    <modal-title>{{ctrl.defineConceptTitle | translate}}</modal-title>

    <modal-body>

      <div class="row">

        <div class="col-md-4">
          <p translate>Concept search info</p>
          <div class="input-group input-group-lg">
            <input autofocus type="text" class="form-control" placeholder="{{'Search from concept database' | translate}}"
                   ng-model="ctrl.searchText"
                   ng-model-options="{ debounce: { 'default': 500, 'blur': 0 } }"
                   key-control="ctrl.searchResults"
                   ignore-dirty />
            <i class="glyphicon glyphicon-search form-control-feedback"></i>
          </div>

          <div class="search-panel">
            <span class="title" translate>Filter results</span>
            <div class="form-group">
              <label for="vocabulary" translate>Vocabulary filter</label>
              <div class="input-group input-group-lg">
                <div class="selectContainer">
                  <select id="vocabulary" class="form-control" ng-model="ctrl.selectedVocabulary" ignore-dirty
                          ng-options="ctrl.translateVocabulary(vocabulary) for vocabulary in ctrl.vocabularies">
                    <option value="" translate>All vocabularies</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <a ng-show="ctrl.selectedVocabulary && !ctrl.selectedVocabulary.local" ng-href="{{ctrl.selectedVocabulary.href}}" target="_blank" translate>Browse vocabulary</a>
        </div>

        <div class="col-md-4 search-results">
          <ajax-loading-indicator ng-if="ctrl.loadingResults"></ajax-loading-indicator>

          <search-results ng-if="!ctrl.loadingResults" items="ctrl.searchResults" selected="ctrl.selectedItem" on-select="ctrl.selectItem(item)" edit-in-progress="ctrl.editInProgress">
            <h5>{{searchResult | translateLabel: ctrl.model}} <span ng-show="searchResult.suggestion">({{'suggestion' | translate}})</span></h5>
            <p>{{searchResult.vocabulary | translateLabel: ctrl.model}} <ajax-loading-indicator-small ng-if="ctrl.loadingSelection(searchResult)"></ajax-loading-indicator-small></p>
          </search-results>
        </div>

        <div class="col-md-4 search-selection">
          <div ng-if="ctrl.selection">

            <div ng-if="ctrl.isSelectionConcept()">
              <non-editable ng-if="!ctrl.selection.suggestion" data-title="Concept label" value="ctrl.selection.label" context="ctrl.context"></non-editable>
              <non-editable ng-if="ctrl.selection.suggestion" data-title="Concept suggestion label" value="ctrl.selection.label" context="ctrl.context"></non-editable>
              <non-editable data-title="Concept id" value="ctrl.selection.id" context="ctrl.context"></non-editable>
              <non-editable data-title="Definition" value="ctrl.selection.comment" context="ctrl.context"></non-editable>
            </div>

            <div ng-if="ctrl.isSelectionNewConceptData()">

              <editable data-title="Vocabulary" context="ctrl.context" autofocus>
                <select id="vocabularySelection" class="form-control" required ng-model="ctrl.selection.vocabulary"
                        ng-options="ctrl.translateVocabulary(vocabulary) for vocabulary in ctrl.selectableVocabularies">
                </select>
              </editable>

              <editable data-title="Concept label" context="ctrl.context">
                <div class="input-group input-group-md">
                  <input id="conceptLabel" type="text" class="form-control" required string-input="label" ng-model="ctrl.selection.label" />
                </div>
              </editable>

              <editable data-title="Definition" context="ctrl.context">
                <div class="input-group input-group-md">
                  <textarea id="conceptComment" class="form-control" required string-input ng-model="ctrl.selection.comment"></textarea>
                </div>
              </editable>

              <editable-concept-select concept="ctrl.selection.broaderConcept" data-title="Broader concept" model="ctrl.model" allow-suggestions="false"></editable-concept-select>

              <br />
              <p><span translate>Concept is suggested to vocabulary</span> {{ctrl.selection.vocabulary.title | translateValue: ctrl.model}}</p>
            </div>

          </div>
        </div>

      </div>
    </modal-body>

    <modal-buttons>
      <button type="button" class="btn btn-default cancel" ng-click="ctrl.close()" translate>Cancel</button>
      <button type="button" class="btn btn-default confirm" ng-click="ctrl.confirm()" ng-disabled="!ctrl.selection || form.$invalid || form.$pending">{{ctrl.buttonTitle | translate}}</button>
    </modal-buttons>

  </modal-template>
</form>
