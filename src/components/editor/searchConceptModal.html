<form name="form">
  <modal-template editing="true">
    <modal-title>{{ctrl.defineConceptTitle | translate}}</modal-title>

    <modal-body>

      <div class="row">

        <div class="col-md-4">
          <p translate>Concept search info</p>
          <div class="input-group input-group-lg">
            <input autofocus type="text" class="form-control" placeholder="{{'Search from concept database' | translate}}"
                   ng-model="ctrl.searchText"
                   ng-model-options="{ debounce: { 'default': 500, 'blur': 0 } }"
                   key-control="ctrl.searchResults"
                   ignore-dirty />
            <i class="glyphicon glyphicon-search form-control-feedback"></i>
          </div>

          <label for="reference" translate>Reference</label>
          <div class="input-group input-group-lg">
            <div class="selectContainer">
              <select id="reference" class="form-control" ng-model="ctrl.selectedReference" ignore-dirty
                      ng-options="reference | translateLabel for reference in ctrl.references">
                <option value="" translate>All references</option>
              </select>
            </div>
          </div>

          <a ng-show="ctrl.selectedReference && !ctrl.selectedReference.isLocal()" ng-href="{{ctrl.selectedReference.href}}" target="_blank" translate>Browse vocabulary</a>
        </div>

        <div class="col-md-4 search-results">
          <ajax-loading-indicator ng-if="ctrl.loadingResults"></ajax-loading-indicator>

          <search-results ng-if="!ctrl.loadingResults" items="ctrl.searchResults" on-select="ctrl.selectItem(item)" edit-in-progress="ctrl.editInProgress">
            <h5>{{searchResult | translateLabel}} <span ng-show="searchResult.suggestion">({{'suggestion' | translate}})</span></h5>
            <p>{{searchResult.reference | translateLabel}} <ajax-loading-indicator-small ng-if="ctrl.loadingSelection(searchResult)"></ajax-loading-indicator-small></p>
          </search-results>
        </div>

        <div class="col-md-4 search-selection">
          <div ng-show="ctrl.selection">

            <div ng-if="ctrl.isConcept(ctrl.selection)">
              <non-editable ng-if="!ctrl.selection.suggestion" title="Concept" value="ctrl.selection.label"></non-editable>
              <non-editable ng-if="ctrl.selection.suggestion" title="Concept suggestion" value="ctrl.selection.label"></non-editable>
              <non-editable title="Id" value="ctrl.selection.id"></non-editable>
              <non-editable title="Definition" value="ctrl.selection.comment"></non-editable>
            </div>

            <div ng-if="!ctrl.isConcept(ctrl.selection)">
              <editable title="Concept">
                <div class="input-group input-group-md">
                  <input id="conceptLabel" type="text" class="form-control" required string-input="label" ng-model="ctrl.formData.concept.label" />
                </div>
              </editable>

              <editable title="Definition">
                <div class="input-group input-group-md">
                  <textarea id="conceptComment" class="form-control" required string-input ng-model="ctrl.formData.concept.comment"></textarea>
                </div>
              </editable>

              <div class="editable-wrap">
                <subject-view subject="ctrl.formData.concept.broaderConcept" title="Broader concept"></subject-view>
                <div ng-class="{'model-view__sub': !!ctrl.formData.concept.broaderConcept}">
                  <button type="button" class="btn btn-default btn-sm" ng-click="ctrl.selectBroaderConcept()" translate>Choose broader concept</button>
                </div>
              </div>

              <br />
              <p><span translate>Concept is suggested to scheme</span> {{ctrl.selection.reference | translateLabel}}</p>
            </div>

            <div ng-if="ctrl.newEntityCreation">
              <editable title="{{ctrl.labelTitle}}">
                <div class="input-group input-group-md">
                  <input id="name" type="text" class="form-control" required string-input="label" ng-model="ctrl.formData.entity.label" />
                </div>
              </editable>
            </div>

          </div>
        </div>

      </div>
    </modal-body>

    <modal-buttons>
      <button type="button" class="btn btn-default" ng-click="ctrl.close()" translate>Cancel</button>
      <button type="button" class="btn btn-default" ng-click="ctrl.confirm()" ng-disabled="!ctrl.selection || form.$invalid || form.$pending">{{ctrl.buttonTitle | translate}}</button>
    </modal-buttons>

  </modal-template>
</form>
